# QA Test Cases - GPS Signal Detection & Dead Reckoning

## Overview
GPS 신호 손실 감지 및 Dead Reckoning 기능에 대한 수동 테스트 케이스 문서입니다.

**테스트 버전:** v1.0
**작성일:** 2025-12-22
**대상 기능:** GPS Signal Detection (Step 1), Dead Reckoning (Step 2)

---

## Test Environment

### Prerequisites
- iOS 17.0 이상 기기 또는 시뮬레이터
- 위치 권한 허용 상태
- 앱 최신 빌드 설치

### Test Tools
- Xcode Simulator (위치 시뮬레이션)
- Console.app (로그 확인)
- 실제 iOS 기기 (터널 테스트용)

---

## Test Cases

### TC-001: Start 버튼 필수 확인

| 항목 | 내용 |
|------|------|
| **ID** | TC-001 |
| **제목** | Start 버튼 클릭 전 요금 미계산 |
| **우선순위** | High |
| **전제조건** | 앱 설치, GPS 권한 허용 |

**테스트 단계:**
1. 앱 실행
2. Start 버튼 클릭하지 않은 상태로 대기
3. 기기 이동 (시뮬레이터의 경우 위치 시뮬레이션)
4. 요금 표시 확인

**예상 결과:**
- [ ] 요금 미터에 기본요금만 표시됨 (예: 4,800원)
- [ ] 거리 표시 0.0 km
- [ ] 시간 표시 0:00

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-002: 정상 GPS 요금 계산

| 항목 | 내용 |
|------|------|
| **ID** | TC-002 |
| **제목** | 정상 GPS 신호에서 요금 계산 |
| **우선순위** | High |
| **전제조건** | TC-001 완료 |

**테스트 단계:**
1. Start 버튼 클릭
2. 정상 GPS 신호 환경에서 이동
3. 약 1km 이동 후 요금 확인

**예상 결과:**
- [ ] 거리에 따라 요금 증가
- [ ] 속도에 따라 거리/시간 요금 분리 계산 (병산제)
- [ ] GPS 신호 아이콘 정상 표시 (location.fill)

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-003: GPS 신호 약화 감지

| 항목 | 내용 |
|------|------|
| **ID** | TC-003 |
| **제목** | GPS 신호 약화 상태 감지 |
| **우선순위** | Medium |
| **전제조건** | 미터 작동 중 |

**테스트 단계:**
1. 미터 작동 시작
2. GPS 신호가 약한 지역으로 이동 (건물 내부, 지하주차장 입구 등)
3. Console에서 GPS 로그 확인

**예상 결과:**
- [ ] 로그에 "[GPS] 신호 약화됨 - 정확도: XXm" 출력
- [ ] gpsSignalState가 .weak으로 변경
- [ ] 신호 아이콘 변경 (location)

**로그 확인 방법:**
```bash
# Console.app에서 필터:
Category: GPS
Process: HoguMeter
```

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-004: GPS 신호 손실 - Dead Reckoning 활성화

| 항목 | 내용 |
|------|------|
| **ID** | TC-004 |
| **제목** | GPS 손실 시 Dead Reckoning 활성화 |
| **우선순위** | High |
| **전제조건** | 미터 작동 중, 차량 이동 중 (속도 > 5km/h) |

**테스트 단계:**
1. 미터 작동 시작
2. 일정 속도로 주행 (예: 60 km/h)
3. 터널 진입 또는 GPS 음영 지역 진입
4. Console 로그 및 앱 상태 확인

**예상 결과:**
- [ ] 로그에 "[GPS] 신호 손실" 출력
- [ ] 로그에 "[DR] Dead Reckoning 시작 - 속도: XX km/h" 출력
- [ ] 거리가 계속 누적됨 (마지막 속도 기준)
- [ ] 신호 아이콘 변경 (location.slash)

**Dead Reckoning 계산 공식:**
```
추정 거리 = 마지막 속도(m/s) × 경과 시간(초)
예: 60 km/h = 16.67 m/s
10초 후 추정 거리 = 16.67 × 10 = 166.7m
```

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-005: Dead Reckoning 시간 제한 (180초)

| 항목 | 내용 |
|------|------|
| **ID** | TC-005 |
| **제목** | Dead Reckoning 180초 만료 |
| **우선순위** | Medium |
| **전제조건** | Dead Reckoning 활성 상태 |

**테스트 단계:**
1. TC-004 상태에서 시작
2. GPS 손실 상태 180초 이상 유지
3. 로그 확인

**예상 결과:**
- [ ] 180초 경과 후 "[DR] Dead Reckoning 만료" 로그 출력
- [ ] deadReckoningState가 .expired로 변경
- [ ] 추가 거리 추정 중단
- [ ] 마지막 추정 거리는 보존됨

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-006: GPS 복구 후 거리 반영

| 항목 | 내용 |
|------|------|
| **ID** | TC-006 |
| **제목** | 터널 탈출 시 추정 거리 반영 |
| **우선순위** | High |
| **전제조건** | Dead Reckoning 활성 상태 |

**테스트 단계:**
1. TC-004 상태에서 시작
2. 터널 탈출 (GPS 신호 복구)
3. 총 거리 확인

**예상 결과:**
- [ ] 로그에 "[GPS] 신호 복구됨" 출력
- [ ] 로그에 "[DR] Dead Reckoning 종료 - 추정 거리: XXXm" 출력
- [ ] totalDistance에 추정 거리가 포함됨
- [ ] 정상 GPS 계산 재개
- [ ] 신호 아이콘 정상 복구 (location.fill)

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-007: 정차 상태에서 GPS 손실

| 항목 | 내용 |
|------|------|
| **ID** | TC-007 |
| **제목** | 정차 시 Dead Reckoning 미시작 |
| **우선순위** | Medium |
| **전제조건** | 미터 작동 중, 차량 정차 |

**테스트 단계:**
1. 미터 작동 시작
2. 차량 정차 (속도 = 0)
3. GPS 신호 손실 발생

**예상 결과:**
- [ ] GPS 손실은 감지됨
- [ ] Dead Reckoning 시작되지 않음 (속도 < 5 km/h)
- [ ] 로그에 "[DR] Dead Reckoning 시작 불가 - 속도 부적합" 출력
- [ ] 추정 거리 0 유지

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-008: Stop → Reset 플로우

| 항목 | 내용 |
|------|------|
| **ID** | TC-008 |
| **제목** | 미터 정지 후 리셋 |
| **우선순위** | High |
| **전제조건** | 미터 작동 중, 요금 누적 상태 |

**테스트 단계:**
1. 미터 작동으로 요금 누적
2. Stop 버튼 클릭
3. Reset 버튼 클릭

**예상 결과:**
- [ ] Stop 후: 요금 유지, 계산 중지
- [ ] Reset 후: 기본요금으로 초기화
- [ ] 거리 0.0 km, 시간 0:00

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-009: Stop 버튼만 클릭 (Reset 미클릭)

| 항목 | 내용 |
|------|------|
| **ID** | TC-009 |
| **제목** | Stop 후 요금 유지 확인 |
| **우선순위** | Medium |
| **전제조건** | 미터 작동 중 |

**테스트 단계:**
1. 미터 작동으로 요금 누적 (예: 15,000원)
2. Stop 버튼 클릭
3. 요금 표시 확인

**예상 결과:**
- [ ] 요금 그대로 표시 (15,000원)
- [ ] 거리/시간 그대로 유지
- [ ] 추가 계산 없음

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

### TC-010: 저속 구간에서 Dead Reckoning

| 항목 | 내용 |
|------|------|
| **ID** | TC-010 |
| **제목** | 저속 주행 중 GPS 손실 시 시간 요금 계산 |
| **우선순위** | Medium |
| **전제조건** | 미터 작동 중, 저속 주행 (< 15.72 km/h) |

**테스트 단계:**
1. 미터 작동 시작
2. 저속 주행 (예: 10 km/h)
3. GPS 손실 발생
4. GPS 복구 후 확인

**예상 결과:**
- [ ] Dead Reckoning 시작됨 (속도 > 5 km/h 이므로)
- [ ] 복구 시 거리 대신 시간(lowSpeedDuration)으로 계산
- [ ] 로그에 "[DR] 추정 시간 반영 (저속)" 출력

**실제 결과:**
```
[ ] Pass  [ ] Fail
Notes:
```

---

## Logging Verification Checklist

Console.app에서 아래 로그가 정상 출력되는지 확인:

### GPS 신호 관련 로그
- [ ] `[GPS] 위치 추적 시작`
- [ ] `[GPS] 위치 추적 중지`
- [ ] `[GPS] 신호 상태 변경: 정상 → 약함`
- [ ] `[GPS] 신호 상태 변경: 약함 → 손실`
- [ ] `[GPS] 신호 상태 변경: 손실 → 정상`
- [ ] `[GPS] 신호 약화됨 - 정확도: XXm`
- [ ] `[GPS] 신호 손실 - 원인: ...`
- [ ] `[GPS] 신호 복구됨 - 정확도: XXm`
- [ ] `[GPS] 마지막 유효 위치 저장 - 속도: XX km/h`

### Dead Reckoning 관련 로그
- [ ] `[DR] Dead Reckoning 시작 - 속도: XX km/h`
- [ ] `[DR] Dead Reckoning 시작 불가 - 속도 부적합`
- [ ] `[DR] 추정 중 - 거리: XXXm, 경과: XX초` (10초마다)
- [ ] `[DR] Dead Reckoning 종료 - 추정 거리: XXXm, 경과 시간: XX초`
- [ ] `[DR] Dead Reckoning 만료 (180초 초과)`
- [ ] `[DR] 추정 거리 반영 (고속): XXXm`
- [ ] `[DR] 추정 시간 반영 (저속): XX초`

---

## Xcode Simulator Location Testing

### 시뮬레이터에서 위치 시뮬레이션

1. **Debug > Location > Custom Location**
   - 원하는 좌표 입력
   - 정확도는 시뮬레이터에서 제어 불가

2. **Debug > Location > Freeway Drive**
   - 고속 이동 시뮬레이션

3. **GPX 파일 사용**
   - 터널 구간을 포함한 GPX 파일 생성
   - Xcode에서 GPX 파일 재생

### GPX 파일 예시 (터널 시나리오)
```xml
<?xml version="1.0"?>
<gpx version="1.1">
  <wpt lat="37.5665" lon="126.9780">
    <time>2024-01-01T00:00:00Z</time>
  </wpt>
  <wpt lat="37.5670" lon="126.9785">
    <time>2024-01-01T00:00:05Z</time>
  </wpt>
  <!-- 터널 구간: 위치 업데이트 없음으로 시뮬레이션 -->
  <wpt lat="37.5680" lon="126.9795">
    <time>2024-01-01T00:00:30Z</time>
  </wpt>
</gpx>
```

---

## Edge Cases

### EC-001: 앱 백그라운드 전환
- 백그라운드에서 Dead Reckoning 계속 동작 확인
- 포그라운드 복귀 시 상태 유지

### EC-002: 메모리 부족 상황
- Dead Reckoning 중 메모리 경고 발생 시 처리

### EC-003: 극단적 속도
- 200 km/h 초과 속도에서 상한 적용 확인
- 5 km/h 미만에서 Dead Reckoning 미시작 확인

### EC-004: 연속 터널
- 터널 → 일반도로 → 터널 연속 통과 시 정상 동작

### EC-005: 긴 터널 (180초 초과)
- 3분 이상 터널에서 만료 처리 확인

---

## Test Results Summary

| TC ID | 제목 | 결과 | 비고 |
|-------|------|------|------|
| TC-001 | Start 버튼 필수 | | |
| TC-002 | 정상 GPS 요금 계산 | | |
| TC-003 | GPS 신호 약화 감지 | | |
| TC-004 | GPS 손실 - Dead Reckoning | | |
| TC-005 | 180초 시간 제한 | | |
| TC-006 | GPS 복구 후 거리 반영 | | |
| TC-007 | 정차 시 Dead Reckoning 미시작 | | |
| TC-008 | Stop → Reset 플로우 | | |
| TC-009 | Stop 후 요금 유지 | | |
| TC-010 | 저속 Dead Reckoning | | |

**테스트 담당자:**
**테스트 일자:**
**빌드 버전:**

---

## Revision History

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2025-12-22 | 초기 작성 | Claude Code |
